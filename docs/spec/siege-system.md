# Siege System

## Core Mechanics

Sieges are a means of **destroying wealth and creating scarcity**. Hub vulnerability is determined by two opposing forces:

**Encroachment** (Distance into Hostile Territory):
* Measures how far from civilization the hub is located
* Controls **individual enemy strength** in siege waves
* High encroachment = elite/veteran enemies
* Naturally decreases as hubs grow (player presence pushes back frontier)

**Anger** (Hub Development & Activity):
* Measures how much the hub has disrupted the natural order
* Controls **wave size** (number of attackers)
* Generated by building structures, particularly factories
* Naturally increases as hubs grow and develop

## The Natural Evolution

Hubs evolve through a predictable lifecycle based on these opposing pressures:

**Frontier Camps (Early Stage):**
* High encroachment → strong individual enemies
* Low anger → small waves
* Challenge: Elite threats in manageable numbers
* Ideal for veteran players

**Growing Towns (Mid Stage):**
* Medium encroachment → moderate enemy strength
* Medium anger → medium waves
* Challenge: Balanced threat requiring skilled coordination

**Established Cities (Late Stage):**
* Low encroachment → weaker individual enemies
* High anger → massive waves
* Challenge: Overwhelming numbers of manageable enemies
* Defended primarily by mid-level players

## Influence System

### Influence Radius

```
radius = population * 3.0 tiles
```

Examples:
* 25 pop camp → 75 tile radius
* 100 pop town → 300 tile radius
* 1000 pop city → 3000 tile radius

### Influence Falloff (Distance)

```
influence = (1.0 - distance/radius)³
```

Steep dropoff curve: slow decline near center, rapid falloff through mid-range, slow approach to zero at edge.

### Maximum Influence (Population)

```
max_influence = sqrt(population / 1000.0), capped at 1.0
```

Examples:
* 25 pop camp → 0.158 max influence
* 100 pop town → 0.316 max influence
* 1000 pop city → 1.0 max influence

## Encroachment Calculation

At any hex, **sum all hub influences** (additive, capped at 1.0):

```
total_influence = sum of all (hub.max_influence * distance_factor)
encroachment = MAX_ENCROACHMENT * (1.0 - total_influence)
```

**Key Properties:**
* Multiple hubs of similar size extend safe territory cooperatively
* Smaller hubs near larger ones contribute minimally (overshadowed)
* Only the largest hubs (1000+ pop) can fully suppress encroachment at their center

## Anger Calculation

Each hub accumulates anger from **all overlapping hub influences**:

```
total_anger = base_anger + sum(other_hub.anger * influence_factor)
```

**No size multiplier** - hubs accumulate the same anger they would generate at that distance, regardless of relative sizes.

**Anger Sources:**
* Player homesteads: moderate anger
* NPC homesteads: moderate anger (but don't attract more NPCs)
* Factories: significantly more anger than homesteads
* Economic activity and resource extraction: scaling anger

## Strategic Implications

### Urbanization Incentives

Two small hubs near each other vs. one merged hub:

**Separate hubs:**
* Each faces independent sieges
* Redundant defense costs
* Minimal cooperation benefit

**Merged hub:**
* Single larger siege
* Concentrated defense
* Economy of scale
* Larger influence radius

### Deadly Proximity Zones

Small hub near large city:
* Accumulates massive anger from city (can be 8-10x base anger)
* Provides minimal encroachment benefit (overshadowed by city)
* Faces overwhelming waves of weak enemies
* Economic death trap - forces merger or relocation

### Safe Patterns

* **Frontier outposts:** Small camps far apart, deep in wilderness (high encroachment, low anger - elite small waves)
* **Regional towns:** Medium hubs spaced 1000+ tiles apart (balanced sieges)
* **Capital cities:** One massive hub per region (low encroachment, high anger - massive waves of weak enemies)

## Hub Merging

### Automatic Merge Trigger

When urban cores overlap (10% of influence radius):

```
urban_core = radius * 0.1
merge_triggered = distance < (core_a + core_b)
```

### Merge Process

1. Vote phase - residents of both hubs vote (majority required)
2. Location selection - weighted by population
3. Asset consolidation - homesteads, NPCs, coffers, factories all merge
4. Transition period - reduced defenses during "construction" (creates risk/reward)

### Merge Benefits

* Combined population = larger influence radius
* Economy of scale on NPC defenders
* Higher-tier services
* Lower per-capita anger
* Single coordinated defense instead of multiple vulnerable points

## Example Scenarios

### Town 300 tiles from City

* Anger: 414 (8.3x base)
* Encroachment: 0.0
* Result: Massive waves of weakest enemies - unsustainable

### Town 1500 tiles from City

* Anger: 112 (2.25x base)
* Encroachment: 5.59
* Result: Moderate waves of medium-strength enemies - challenging but viable

### Town Between Two Cities (1250 tiles each)

* Anger: 447 (8.9x base)
* Encroachment: 0.0
* Result: No-man's land death trap

### Two Towns 200 tiles Apart

* Anger: 52 each (1.04x base)
* Encroachment: 6.72
* Result: Cooperative territory extension, frontier-level threats

### Lone Frontier Camp

* Anger: 10 (1x base)
* Encroachment: 8.42
* Result: Small waves of elite enemies - perfect for veterans
